<?xml version="1.0" encoding="UTF-8" ?>
<Module>
<ModulePrefs title="SHGadget for Google Sites" author="elekingmole">
	<Require feature="setprefs"/>
	<Require feature="dynamic-height"/>
	<Require feature="opensocial-0.9" />
	<Preload href="__UP_targeturl__" />
</ModulePrefs>

<UserPref name="baseurljs" datatype="string" default_value="http://alexgorbatchev.com/pub/sh/current/scripts"/>
<UserPref name="baseurlcss" datatype="string" default_value="http://alexgorbatchev.com/pub/sh/current/styles"/>
<UserPref name="language" datatype="string" />
<UserPref name="languagelower" datatype="string" />
<UserPref name="theme" datatype="string" />
<UserPref name="targeturl" datatype="string" />
<UserPref name="baseline" datatype="string" default_value="0"/>
<UserPref name="targetline" datatype="string" />
<UserPref name="comment" datatype="string" />
<UserPref name="additionalprocess" datatype="string" />
<UserPref name="urlshow" datatype="bool" default_value="false" />
<UserPref name="dynamicheight" datatype="bool" default_value="false" />
<UserPref name="firstline" datatype="string" />
<UserPref name="highlight" datatype="string" />
<UserPref name="tabsize" datatype="string" />
<UserPref name="shtitle" datatype="string" />
<UserPref name="shtitleValue" datatype="string" />
<UserPref name="shOption" datatype="string" />
<UserPref name="collapse" datatype="bool" default_value="false" />
<UserPref name="gutter" datatype="bool" default_value="false" />

<UserPref name="shbrushxml" datatype="string" />
<UserPref name="additionalprocesslocation" datatype="string" />

<Content type="html"><![CDATA[

<link type="text/css" href="__UP_baseurlcss__/shCore.css" rel="stylesheet"/>
<link type="text/css" href="__UP_baseurlcss__/shTheme__UP_theme__.css" rel="stylesheet"/>
<script src="__UP_baseurljs__/shCore.js" type="text/javascript"></script>
<script src="__UP_baseurljs__/shAutoloader.js" type="text/javascript"></script>
<script src="__UP_baseurljs__/shBrushXml.js" type="text/javascript"></script>

<script type="text/javascript">
	var prefs=new gadgets.Prefs();
	function doHighlight(){
		getData();
	}

	

	function getData() {
		var params = {};
		params[gadgets.io.RequestParameters.CONTENT_TYPE] = gadgets.io.ContentType.TEXT;
		var url= "__UP_targeturl__";
		gadgets.io.makeRequest(url, response, params);
	}




	function processData(str){
		str = htmlEscape(str);
		var strArray =  str.split("\n");
		var returnHtml=""; 

		var tempString = "__UP_targetline__";
		
		var targetlineArray = new Array();

		if(prefs.getBool("urlshow") == true){
			returnHtml ="<a href='__UP_targeturl__' target='_blank'>__UP_targeturl__</a>"+"\n\n";
		}
		
		returnHtml +="<pre id='code_pre'  class='brush:__UP_languagelower__;__UP_shOption__' __UP_shtitleValue__ >";

		if(tempString.length>0){
			if(tempString.indexOf(",") != -1){
			
				targetlineArray = tempString.split(",");
			}else{

				if((tempString.indexOf("F") != -1 )){
					var index;
					
					if(tempString.length ==1){
						index= 0;
					}else{
						index = parseInt(tempString.substring(1,tempString.length))
					}
					
					if(strArray[index].indexOf("L-I-N-E")!=-1){
						var targetlinefromSource = strArray[index].split("L-I-N-E");
						if(targetlinefromSource[1].length>0){
							targetlineArray = targetlinefromSource[1].split(",");
						}
					}else{
						window.alert("Line not designated ");
					}
				}else{
					
					
					
					targetlineArray.push(tempString);				
				}
			}
			returnHtml+=processTargetlineData(targetlineArray,strArray);
			
		}else{
			for (i=0;i<strArray.length;i++){
				
				returnHtml+=strArray[i];
			}
		}

		returnHtml+="</pre>";
		document.getElementById('content_div').innerHTML += returnHtml;
		SyntaxHighlighter.autoloader('__UP_languagelower__                   __UP_baseurljs__/shBrush__UP_language__.js');
		SyntaxHighlighter.all();
		
		if(prefs.getBool("dynamicheight") == true){
		 gadgets.window.adjustHeight();
		}
	}

	function htmlEscape(str){
		str=str.replace(/>/g,'&gt;');
		str=str.replace(/</g,'&lt;');
		return str;
	}

function matchNumber(targetString){
		if(targetString.match(/^[0-9]+/)){
			return true;
		}else{
			return false;
		}
	}


	
	function processTargetlineData(targetlineArray,strArray){
		var returnData="";
		
		for (i=0;i<targetlineArray.length;i++){
			if(targetlineArray[i].indexOf("-") != -1 && targetlineArray[i].indexOf("S") == -1){
				var tempNumber = targetlineArray[i].split("-");
				
				if(tempNumber[0].length>0 && tempNumber[1].length>0){
					if(matchNumber(tempNumber[0]) && matchNumber(tempNumber[1])){
						for (j= parseInt(tempNumber[0]);j<=parseInt(tempNumber[1]);j++){
							returnData+=strArray[j];
						}
					}
				}else if(tempNumber[0].length>0){
					if(matchNumber(tempNumber[0])){
						for (k= parseInt(tempNumber[0]);k<strArray.length;k++){
							returnData+=strArray[k];
						}
					}
				}else if(tempNumber[1].length>0){
					if(matchNumber(tempNumber[1])){
						for (l= 0;l<=parseInt(tempNumber[1]);l++){
							returnData+=strArray[l];
						}
					}
				}
			}else{
				if(targetlineArray[i].match(/^[0-9]+/)){
					returnData+=strArray[parseInt(targetlineArray[i])];
				}else if(targetlineArray[i].substring(0,1) =="S" && targetlineArray[i].length>1){
					returnData+= targetlineArray[i].substring(1,targetlineArray[i].length) + "\r\n";
				}else if(targetlineArray[i].substring(0,1) =="A" && targetlineArray[i].length>1){
					returnData= returnData.substring(0,returnData.length-1)+
						targetlineArray[i].substring(1,targetlineArray[i].length) + "\r\n";
				}else if(targetlineArray[i].substring(0,1) =="N"){
					returnData+= "\r\n";
				}
			}
		}
		return returnData;
	}

	function response(obj) {
		processData(obj.text);
	}

	

	gadgets.util.registerOnLoadHandler(doHighlight);
</script>
<div id="content_div"></div>
]]>
</Content>

<Content type="html" view="configuration" preferred_height="400">
<![CDATA[
<script type="text/javascript">
	var prefs=new gadgets.Prefs();

	function init() {
		initStringValue(new Array('baseurljs','baseurlcss','targeturl','targetline','baseline','comment','additionalprocess',
		'firstline','highlight','tabsize','shtitle','language','theme'));
	
		initBoolValue(new Array('dynamicheight','urlshow','collapse','gutter'));
	
		update();
	}

	function initBoolValue(blns){
		for (i=0;i<blns.length;i++){
			var targetboolean=prefs.getBool(blns[i]);
			if(targetboolean ==true){
				document.getElementById(blns[i]).checked=true;
			}else{
				document.getElementById(blns[i]).checked=false;
			}
		}
	}

	function initStringValue(strs){
		for (i=0;i<strs.length;i++){
			var targetvalue=prefs.getString(strs[i]);
			if (targetvalue.length>0){
				document.getElementById(strs[i]).value=targetvalue;
			}
		}
	}

	function updatePrefs(strs){
		for (i=0;i<strs.length;i++){
			prefs.set(strs[i],document.getElementById(strs[i]).value);
		}
	}

	function updatePrefsBln(blns){
		for (i=0;i<blns.length;i++){
			if(document.getElementById(blns[i]).checked==true){
				prefs.set(blns[i],true);
			}else{
				prefs.set(blns[i],false);
			}
		}
	}

	function update() {
		updatePrefs(new Array('language','theme','baseurljs','baseurlcss','targeturl','baseline','comment','additionalprocess',
						'targetline','firstline','highlight','tabsize','shtitle'));
		
		updatePrefsBln(new Array('dynamicheight','urlshow','collapse','gutter'));

		var shOption ="";
	
		if(document.getElementById('collapse').checked==true){
			shOption +=  " collapse: true;";
		}
	
		if(document.getElementById('gutter').checked==false){
			shOption +=  " gutter: false;";
		}
	
		if(prefs.getString('firstline').length>0){
			shOption +=  " first-line: " + prefs.getString('firstline') + ";";
		}
	
		if(prefs.getString('highlight').length>0){
			shOption +=  " highlight:[" + prefs.getString('highlight') + "];";
		}

		if(prefs.getString('tabsize').length>0){
			shOption +=  " tab-size: " + prefs.getString('tabsize') + ";";
		}

		if(prefs.getString('shtitle').length>0){
			prefs.set('shtitleValue', 'title="'+ prefs.getString('shtitle') +'"' );
		}else{
			prefs.set('shtitleValue',"");
		}

		prefs.set('languagelower', document.getElementById('language').value.toLowerCase());	
		prefs.set('shOption',shOption);
	}
</script>

<table style="width: 100%;">
	<tr>
		<td>
			<H3>Source Setting</H3>
		</td>
		<td>
		</td>
	</tr>
	<tr>
		<td>
			<strong>BaseURL(js):</strong>
		</td>
		<td>
			<textarea id="baseurljs" style="width: 100%;" onchange="update()"></textarea>
		</td>
	</tr>
	<tr>
		<td>
			<strong>BaseURL(css):</strong>
		</td>
		<td>
			<textarea id="baseurlcss" style="width: 100%;" onchange="update()"></textarea>
		</td>
	</tr>
	<tr>
		<td>
			<strong>BaseLine:(nn)</strong>
		</td>
		<td>
			<textarea id="baseline" style="width: 100%;" onchange="update()"></textarea>
		</td>
	</tr>
	<tr>
		<td>
			<strong>Commnet:</strong>
		</td>
		<td>
			<textarea id="comment" style="width: 100%;" onchange="update()"></textarea>
		</td>
	</tr>
	<tr>
		<td>
			<strong>AdditionalProcess:</strong>
		</td>
		<td>
			<textarea id="additionalprocess" style="width: 100%;" onchange="update()"></textarea>
		</td>
	</tr>
	
	
	<tr>
		<td>
			<strong>Target Line:(nn,nn-nn,or F)</strong>
		</td>
		<td>
			<textarea id="targetline" style="width: 100%;" onchange="update()"></textarea>
		</td>
	</tr>
	<tr>
		<td>
			<strong>Target URL:</strong>
		</td>
		<td>
			<textarea id="targeturl" style="width: 100%;" onchange="update()"></textarea>
		</td>
	</tr>
</table>
<hr>
<table style="width: 100%;">
	<tr>
		<td>
			<H3>Language Setting</H3>
		</td>
		<td>
		</td>
	</tr>
	<tr>
		<td><strong>Language</strong>
			</td>
		<td>
			<select id="language" onchange="update()" >
				<option value="Java" selected="true">Java</option>
				<option value="JavaFX" >JavaFX</option>
				<option value="Xml" >XML</option>
				<option value="JScript" >JavaScript</option>
				<option value="AppleScript" >AppleScript</option>
				<option value="AS3" >ActionScript3</option>
				<option value="Bash" >Bash/shell</option>
				<option value="CSharp" >C#</option>
				<option value="Cpp" >C++</option>
				<option value="ColdFusion" >ColdFusion</option>
				<option value="Css" >CSS</option>
				<option value="Delphi" >Delphi</option>
				<option value="Diff" >Diff</option>
				<option value="Erlang" >Erlang</option>
				<option value="Groovy" >Groovy</option>
				<option value="Perl" >Perl</option>
				<option value="Php" >PHP</option>
				<option value="Plain" >Plain Text</option>
				<option value="PowerShell" >PowerShell</option>
				<option value="Python" >Python</option>
				<option value="Ruby" >Ruby</option>
				<option value="Sass" >Sass</option>
				<option value="Scala" >Scala</option>
				<option value="Sql" >SQL</option>
				<option value="Vb" >Visual Basic</option>
				<option value="shBrushOther1" >Other1</option>
			</select>
		</td>
	</tr>
	<tr>
		<td><strong>Theme</strong>
		</td>
		<td>
			<select id="theme" onchange="update()">
				<option value="Default" selected="true">Default</option>
				<option value="Django" >Django</option>
				<option value="Eclipse" >Eclipse</option>
				<option value="Emacs" >Emacs</option>
				<option value="FadeToGrey" >FadeToGrey</option>
				<option value="Midnight" >Midnight</option>
				<option value="RDark" >RDark</option>
				<option value="Other1" >Other1</option>
			</select>
		</td>
	</tr>
</table>

<hr>
<table style="width: 100%;">
	<tr>
		<td>
			<input type="checkbox" id="dynamicheight" onClick="update()">dynamicheight
		</td>
	</tr>
	<tr>
		<td>
			<input type="checkbox" id="urlshow" onClick="update()">URL show
		</td>
	</tr>
</table>

<hr>
<table style="width: 100%;">
	<tr>
		<td>
			<input type="checkbox" id="collapse" onClick="update()">collapse
		</td>
	</tr>
	<tr>
		<td>
			<input type="checkbox" id="gutter" onClick="update()">gutter
		</td>
	</tr>

</table>

<table style="width: 100%;">
	<tr>
		<td>
			<strong>firstline:</strong>
		</td>
		<td>
			<textarea id="firstline" style="width: 100%;" onchange="update()"></textarea>
		</td>
	</tr>
	<tr>
		<td>
			<strong>highlight:</strong>
		</td>
		<td>
			<textarea id="highlight" style="width: 100%;" onchange="update()"></textarea>
		</td>
	</tr>
	<tr>
		<td>
			<strong>tabsize:</strong>
		</td>
		<td>
			<textarea id="tabsize" style="width: 100%;" onchange="update()"></textarea>
		</td>
	</tr>
	<tr>
		<td>
			<strong>shtitle:</strong>
		</td>
		<td>
			<textarea id="shtitle" style="width: 100%;" onchange="update()"></textarea>
		</td>
	</tr>
</table>

<script type="text/javascript">
	gadgets.util.registerOnLoadHandler(init);
</script>
]]>
</Content>
</Module>